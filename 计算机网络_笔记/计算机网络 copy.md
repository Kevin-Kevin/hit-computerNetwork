# 计算机网络

> 本笔记基于 
>
> **计算机网络 第 7 版 谢希仁 编著**
>
> 部分参考了 计算机网络 自顶向下方法 第 7 版
>
> 



## 概述

### 分组交换

把较长的信息分成一个个等长的数据段, 加上首部后构成一个**分组**, 分组又称为包, 分组首部可称为**包头**

路由器则是用来转发分组的, 既分组交换

一个分组到了路由器, 路由器先存起来, 寻找合适的链路转发

> 交换方式有三种
>
> 电路交换, 报文交换, 分组交换
>
> 前两种不重要

### 计算机网络的不同类别

1. 广域网 WAN(Wide Area Network)
2. 城域网 MAN(Metropolitan Area Network)
3. 局域网 LAN(Local Area Network)
4. 个人区域网 PAN(Personal Area Network)

> 具体概念见 计算机网络 谢希仁 Page 20

### 计算机网络性能指标

1. 速率
2. 带宽 (和模电的概念不一样)
3. 吞吐量
4. **时延**
5. 时延带宽积
6. **往返时间 RTT**
7. 利用率

### 具有五层协议的计算机网络体系结构 

> 具体概念见 Page 31

![Screen Shot 2021-03-11 at 12.48.21](https://gitee.com/kevinzhang1999/my-picture/raw/master/uPic/Screen%20Shot%202021-03-11%20at%2012.48.21-1615438125890.png)

## 物理层

### 信道复用技术

一条路给多个人使用

1. 频分复用

2. 时分复用

3. 统计时分复用

4. 波分复用
5. 码分复用(光的频分复用)

## 数据链路层

> 1. 以太网帧格式
>
> 2. MTU
>
> 3. ARP 协议, 报文格式, 查询原理, 缓存
>
>    



### 链路, 数据链路, 帧

> Page 71

### 三个基本问题

- 封装成帧

  ip 数据报加上首部和尾部, 构成一个帧

  其实是加上了一个边界, 告诉你我这一帧的开始和结尾

  首尾部还有一些控制信息, 比如帧的数据部分长度上限---最大传输单元 MTU

- 透明传输
  解决帧的数据部分如果出现了和尾部一样的部分会被错认为是一个帧的问题

- 差错检测

  使用 循环冗余检验 CRC  ( Cyclic Redundancy Check ) 

  解决了比特在传输过程中有可能会从 0-1或者 1-0



#### 局域网 ( 也可以说是以太网 ) 

多台主机的网络适配器( 网卡 )通过交换机连接成局域网

#### 以太网帧

![Screen Shot 2021-03-11 at 16.34.17](https://gitee.com/kevinzhang1999/my-picture/raw/master/uPic/Screen%20Shot%202021-03-11%20at%2016.34.17-1615451673570.png)

1. 以太网帧 **数据** 字段为 46-1500 字节, **IP 数据报小于 46 字节会被填充**
2. 目的地址和源地址字段都是其 Mac 地址
3. 类型字段代表后面数据使用的协议, 如 IP 协议, ARP ...
4. 以太网帧没有尾部, 因为曼彻斯特编码, 只要在结束后不发送, 就代表帧结束
5. 图中 FCS 为帧检验序列, 使用 CRC 进行差错检测



### 网络适配器 ( 网卡 )

也有 cpu, ram, rom

具有过滤功能可以识别帧目的 Mac 地址是否是本机 Mac 地址

### Mac 地址

每个网络适配器都有一个唯一的 Mac 地址

在以太网 Mac 帧的首部包含目的 Mac 地址和源 Mac 地址

Mac 地址存储在其网卡的 rom 中

### 地址解析协议 ARP ( Address Resolution Protocol)

根据 IP 地址解析出 Mac 地址

每台主机或者路由器内存中都有一个 ARP 表 ( ARP cache )

该表存储了局域网内各主机的和路由器的 IP 地址和 Mac 地址

当主机要向局域网内主机发送 IP 数据报时, 先看 ARP cache 中有没有

> 如果没有
>
> ARP 进程会在本局域网上广播发送一个 ARP 请求分组	
>
> 分组中包含本机 IP 地址, Mac 地址以及要访问的 IP 地址
>
> 所有主机都会接收到, 但是只有要访问的 IP 地址的主机会响应一个单播



### 交换机

交换机中有一个交换机表

 其中包含了 Mac 地址, 对应的端口号, 以及老化期时间

每次收到一个以太网帧, 交换机会解析以太网帧, 获取 Mac 地址

然后将此 Mac 地址和接收此帧的端口号放入表中 



### ppp, 广播信道, 碰撞检测用不到, 就不写了

##  网络层

> 1. ip 数据报首部格式
> 2. ip 分片
> 3. ip 选路
> 4. 四个协议 : ICMP , IGMP, IP, ARP



### IP 地址

#### IPv4 编址

每个 IP 地址长度为 32 比特, 既 4 个字节, 按点分十进制来书写,如 :  `192.168.0.1`

#### IP 地址分类

IP 地址被分为若干个固定的类, 由两个固定长度的字段组成 : 

**网络号 net-id 和 主机号 host-id**

> CIDR 的出现消除了下图的分类, 使得网络号是不固定的, 减少了路由器中路由表的规模, 后面会写到 CIDR

![image-20210312150536129](../../../Library/Application%20Support/typora-user-images/image-20210312150536129.png)

有几个特殊的 ip 地址

![image-20210312151356686](https://gitee.com/kevinzhang1999/my-picture/raw/master/uPic/image-20210312151356686-1615533236804.png)

路由器转发时根据网络号转发, 网络号一样的就属于一片区域

区域内是由用转发器或网桥连接起来的若干个局域网, 这片区域内的主机的网络号必须一致

路由器由于在两个区域的交界处就要有两个 IP 地址 , 这种主机称为多归属主机





### IP 数据报的格式

![image-20210311173837321](https://gitee.com/kevinzhang1999/my-picture/raw/master/uPic/image-20210311173837321-1615455517495.png)

各字段含义 :  

> 先讲一下分片
>
> 数据链路层协议规定了一个帧中数据字段的最大长度, 既最大传输单元 MTU ( max transfer unit )
>
> 数据报长了就要分片



1. 版本字段 : IP 协议的版本, 目前广泛使用 IPv4, 既 IP version 4

2. 首部长度 字段 :  占 4 位, 令其值为 n , 则首部长度 = n×32 (位) = n×4 (字节)

3. 区分服务 :   一般不用

4. 总长度 :  首部和数据部分之和, 单位是字节

5. 标识 : 每产生一个数据报, 计数器就加 1, 这样可以因为 MTU 分片时正确把拆分的片合起来

6. 标志 :   占 3 位, 只有后两位有意义
   - MF (more fragment) : 为 1 代表后面还有分片, 为 0 代表这是数据报分片中的最后一片
   - DF (don't fragment) : 为 1 代表不能分片, 为 0 才可以分片

7. 片偏移 :  占 13 位, 单位是 8 个字节. 代表原先此片在未分片前原分组中的起始位置, 这也说明了分片的长度一定是 8字节 的倍数

   ![image-20210311221910533](https://gitee.com/kevinzhang1999/my-picture/raw/master/uPic/image-20210311221910533-1615472350701.png)

8. 生存时间 : 8 位, TTL time to live , 数据报每经过一个路由器, 减去一段时间, 为 0 就丢弃数据报; 现在变为**跳数**, 经过一个路由器就减 1

9. 协议 :  代表数据部分使用的协议

10. 首部校验和 :  只校验首部, 采用反码算数运算求和

11. 源地址 :  本机 IP 地址

12. 目的地址 :  目的 IP 地址

13. 首部可变部分



#### IP 层转发分组的流程

路由器将局域网连接起来, 路由器 R1 可以看成既在网 1 中,又在网 2 中

路由器从网 2 收到的分组, 它就将分组中的目的 IP 地址

### 划分子网



## 总结

### 数据发送封装过程

![image-20210308144417311](https://gitee.com/kevinzhang1999/my-picture/raw/master/uPic/image-20210308144417311-1615185857534.png)

### 数据接收拆分过程

![image-20210308144953162](https://gitee.com/kevinzhang1999/my-picture/raw/master/uPic/image-20210308144953162-1615186193341.png)

